<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Adding Github Registry and Authentication To Laravel 5.2</title>
	
	
	
  <link rel="stylesheet" href="//code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/styles/monokai.min.css">
	<link rel="stylesheet" href="https://tutorialedge.net/css/materialize.min.css">
	<link rel="stylesheet" href="https://tutorialedge.net/css/style.css">
	
	<meta name="generator" content="Hugo 0.19" />

	
	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.1/js/materialize.min.js"></script>
	<script src="https://tutorialedge.net/js/highlight.pack.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
	<script async>
			(function (i, s, o, g, r, a, m) {
					i['GoogleAnalyticsObject'] = r;
					i[r] = i[r] || function () {
							(i[r].q = i[r].q || []).push(arguments)
					}, i[r].l = 1 * new Date();
					a = s.createElement(o),
					m = s.getElementsByTagName(o)[0];
					a.async = 1;
					a.src = g;
					m.parentNode.insertBefore(a, m)
			})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
			ga('create', 'UA-10255990-23', 'auto');
			ga('send', 'pageview');
	</script>
</head>
<body>

	<header>
		<nav>
			<div class="nav-wrapper">
				<a class="brand-logo" href="https://tutorialedge.net">TutorialEdge.net</a>
				<a href="#" data-activates="mobile-demo" class="button-collapse"><i class="material-icons">menu</i></a>
				<ul id="nav-mobile" class="right hide-on-med-and-down">
					<li><a href="https://tutorialedge.net/about/">About</a></li>
					<li><a href="https://tutorialedge.net/get-involved/">Get Involved</a></li>
					<li><a href="https://tutorialedge.net/courses/">Courses</a></li>
					<li><a href="https://tutorialedge.net/post/">Tutorials</a></li>
				</ul>
				<ul class="side-nav" id="mobile-demo">
					<li><a href="https://tutorialedge.net/about/">About</a></li>
					<li><a href="https://tutorialedge.net/get-involved/">Get Involved</a></li>
					<li><a href="https://tutorialedge.net/courses/">Courses</a></li>
					<li><a href="https://tutorialedge.net/post/">Tutorials</a></li>
				</ul>
			</div>
		</nav>
	</header>

<div class="title-bar">
	<div class="container">
		<h1>Adding Github Registry and Authentication To Laravel 5.2</h1>
		<p>In this tutorial I&#39;ll be demonstrating to you how you can add github authentication to your Laravel 5 application.</p>
		
		<a href="/tags/laravel-5.2"><div class="chip">laravel-5.2</div></a>
		
		<a href="/tags/php"><div class="chip">php</div></a>
		
	</div>
</div>

<div class="container">
	<div class="row">
		<div class="col l2 m2 s12">
			<div class="sidebar">
     
    <h3>laravel-5.2</h3>
    <ul> 
      
        <li><a href="/post/php/laravel/simple-laravel-pagination/">Simple Laravel 5 Pagination</a></li>
      
        <li><a href="/post/php/laravel/creating-an-admin-area-laravel/">Creating an Admin Area with Laravel 5</a></li>
      
        <li><a href="/post/php/laravel/laravel-5-simple-site-search-bar/">Laravel 5 Simple Site Search Bar Tutorial</a></li>
      
        <li><a href="/post/php/laravel/laravel-routes-cheat-sheet/">Laravel 5.1 Routes Cheat Sheet</a></li>
      
        <li><a href="/post/php/laravel/laravel-5-middleware-tutorial/">Laravel 5 Middleware Tutorial</a></li>
      
        <li><a href="/post/php/laravel/adding-github-oauth-to-laravel-5-2/">Adding Github Registry and Authentication To Laravel 5.2</a></li>
      
        <li><a href="/post/php/laravel/building-a-blog-with-laravel-5-2/">Building A Blog With Laravel 5.2</a></li>
      
        <li><a href="/post/php/laravel/cipher-keylength-invalid-laravel-5-2/">The Cipher and or Key Length are Invalid - laravel 5.2 Issue</a></li>
      
        <li><a href="/post/php/laravel/introduction-to-routing-laravel-5-2/">Introduction To Routing in Laravel 5.2</a></li>
      
        <li><a href="/post/php/laravel/effective-debugging-laravel-5-2/">Effective Debugging of Laravel 5.2 Applications</a></li>
      
    </ul>
    

</div> 
		</div>
		<div class="col l8 m8 s12">	
			<article>
				<div class="info">Author: Elliot Forbes | Posted at: 15.04.2017 08:27</div>
				<div>
					<p>As part of the ongoing work I’ve been doing on this site, I thought it would be a good idea to totally remove the traditional method of registering and logging in and instead replace that with github authentication. This actively reduces the risks that the site takes with regards to storing passwords and allows me to rely upon a relatively secure authentication method rather than having to roll my own.</p>

<h2>Creating a Github Application</h2>

<p>In order for us to use Github’s authentication in our application we are going to need to first register this with Github. Navigate to <a href=”https://github.com/settings/applications/new”>here</a> and fill in the details for your new application. </p>

<p>The callback url should be http://yourapp.com/auth/github/callback </p>

<p>Once you’ve done that you should be redirected to a page that shows you the client ID and the secret. Copy these and add them to your .env file in your laravel 5 application: </p>

<pre><code>GITHUB_ID=abcd12345
GITHUB_SECRET=abcdefg1234567
GITHUB_CALLBACK_URL=https://yourapp.com/auth/github/callback
</code></pre>

<p>Next thing we need to do is add this to our config/services.php</p>

<pre><code>'github' =&gt; [
      'client_id' =&gt; env('GITHUB_ID'),
      'client_secret' =&gt; env('GITHUB_SECRET'),
      'redirect' =&gt; env('GITHUB_CALLBACK_URL'),  
  ],
</code></pre>

<p>After you’ve done this we should be good to go and can proceed with installing Socialite and configuring our app.</p>

<h2>Adding Socialite To Your Laravel 5 Project</h2>

<p>In order for us to use Github’s authentication we are going to need to first add Socialite to our Laravel 5 project. We can do this by performing the following composer command:</p>

<pre><code>composer require laravel/socialite
</code></pre>

<p>Once this has successfully ran we then need to make some modifications to our config/app.php file.</p>

<pre><code>'providers' =&gt; [
		…
  // add our new provider to the providers array 
  'Laravel\Socialite\SocialiteServiceProvider',
],
</code></pre>

<pre><code>'aliases' =&gt; [
  'Socialite' =&gt; 'Laravel\Socialite\Facades\Socialite',
],
</code></pre>

<h2>Configuring our Routes</h2>

<p>In order for visitors to authenticate with github we are going to need a new route that they can navigate to that will trigger out authentication prompt. Navigate to your routes.php file and add the following routes: </p>

<pre><code>Route::get('auth/github', 'Auth\AuthController@redirectToProvider');
Route::get('auth/github/callback', 'Auth\AuthController@handleProviderCallback');
</code></pre>

<p>Now that we’ve added these two routes, we now need to add the functions that they call whenever they are hit.</p>

<h2>Our AuthController File</h2>

<p>Open up your AuthController.php file and add the following 3 functions: </p>

<pre><code>&lt;?php    
/**
  * Redirect the user to the GitHub authentication page.
  *
  * @return Response
  */
public function redirectToProvider(Request $request)
{
    return Socialite::driver('github')
        -&gt;with(['redirect_uri' =&gt; env('GITHUB_CALLBACK_URL' ) . '?redirect=' . $request-&gt;input('redirect')])
        -&gt;redirect();
}

/**
  * Obtain the user information from GitHub.
  *
  * @return Response
  */
public function handleProviderCallback(Request $request)
{
    $user = Socialite::driver('github')-&gt;user();
    Session::put('user', $user);

    $redirect = $request-&gt;input('redirect');
    
    if($redirect)
    {
        return redirect($redirect);
    }
    
    $authUser = $this-&gt;findOrCreateUser($user);

    Auth::login($authUser, true);
            
    return redirect('home');
}

/**
  * Return user if exists; create and return if doesn't
  *
  * @param $githubUser
  * @return User
  */
private function findOrCreateUser($githubUser)
{
    if ($authUser = User::where('github_id', $githubUser-&gt;id)-&gt;first()) {
        Log::info(&quot;User Found&quot;);
        Auth::login($authUser);
        return $authUser;
    }

    return User::create([
        'name' =&gt; $githubUser-&gt;name,
        'email' =&gt; $githubUser-&gt;email,
        'github_id' =&gt; $githubUser-&gt;id,
        'avatar' =&gt; $githubUser-&gt;avatar
    ]);
    }
</code></pre>

<h2>Editing the Database Structure</h2>

<p>So if we are going to be authenticating people using Github’s OAuth2 then we need to be able to store who we have and haven’t already authenticated. To do this we’ll need to modify the database so that it stores the github_id and any subsequent things like the avatar etc. </p>

<p>In this example I just extended my users table by adding an extra row, I prefer doing it using pure sql rather than migrations:</p>

<p><b>Pure SQL</b></p>

<pre><code>ALTER TABLE users ADD github_id INT;
</code></pre>

<p><h3>Updating our Users Model</h2></p>

<p>Finally we need to update our User model. Open up app/User.php and change the following</p>

<pre><code>/**
* The attributes that are mass assignable.
*
* @var array
*/
protected $fillable = ['github_id','name', 'email', 'password'];
</code></pre>

<h2>Testing it All Works</h2>

<p>Now that you’ve configured everything it’s time to check it all works. Navigate to http://yourapp.com/auth/github and you should hopefully be redirected to githubs authentication page on which you can allow your app to use your details. This should then return you to your ‘home’ route or whatever other route you wish to route them back to. </p>

<p>If everything works then congratulations, you’ve now succesfully added github authentication to your Laravel application! </p>

				</div>
				<div>
					<div id="disqus_thread"></div>
<script>





(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://tutorialedge.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
				</div>
			</article>
		</div>

		<div class="col l2 m2 s12">
			<div class="wrapper">
    <div class="container">
      <img src="https://twitter.com/Elliot_F/profile_image?size=original" alt="Elliot Forbes" class="trophy" />
      <h1>Elliot Forbes</h1>
      <span class="score">Follow me:</span>
  
      <div class="buttons">
          <a href="https://twitter.com/Elliot_F" target="_blank" class="button light">
              <span><i class="ion ion-social-twitter"></i> Twitter</span>
          </a>
      </div>
    </div>
</div>

		</div>
		
	</div>
</div>

<div class="join-us">
	<div class="container">
		<div class="row">
			<div class="col l8">
				<h5>Become a Contributor!</h5>
				<p>Think you could improve the articles on this site? Feel free to submit a pull request to the sites github repo.</p>
			</div>
			<div class="col l4">
				<a href="https://github.com/elliotforbes/tutorialedge-v2"><button class="btn valign">Fork Our Repo</button></a>
			</div>
		</div>
	</div>
</div>

<footer class="page-footer">
	<div class="container">
		<div class="row">
			<div class="col l6 s12">
				<h5>TutorialEdge.net</h5>
				<p class="text-lighten-4">This site is dedicated to bringing you the highest quality courses designed to teach you the ins and outs of programming with various frameworks and programming languages.</p>
			</div>
			<div class="col l4 offset-l2 s12">
				<h5>Links</h5>
				<ul>
					<li><a class="text-lighten-3" href="/tutorials">All Tutorials</a></li>
					<li><a class="text-lighten-3" href="/books">Books</a></li>
					<li><a class="text-lighten-3" href="/contact">Contact</a></li>
					<li><a class="text-lighten-3" href="/courses">Courses</a></li>
					<li><a class="text-lighten-3" href="/blog">Blog</a></li>
					<li><a class="text-lighten-3" href="/about">About</a></li>
					
				</ul>
			</div>
		</div>
	</div>
	<div class="footer-copyright">
		<div class="container">
		TutorialEdge © 2016 Copyright 
		</div>
	</div>
</footer>

<script>
$(".button-collapse").sideNav();
</script>